<!-- Title -->
<h1 align="center">YMaps Excel Export</h1>

<p align="center">
  Поиск организаций в Яндекс.Картах через API Поиска по организациям и выгрузка в Excel (.xlsx)
</p>

<p align="center">
  <a href="#возможности">Возможности</a> •
  <a href="#требования">Требования</a> •
  <a href="#установка">Установка</a> •
  <a href="#настройка">Настройка</a> •
  <a href="#запуск">Запуск</a> •
  <a href="#формат-выходного-файла">Формат выходного файла</a> •
  <a href="#частые-проблемы">Частые проблемы</a> •
  <a href="#gitignore">.gitignore</a> •
  <a href="#лицензия">Лицензия</a>
</p>

---

## Возможности

- Поиск организаций по текстовому запросу `TEXT` в заданной области.
- Область поиска задаётся **центром** (долгота/широта) и **диаметром** (км); `bbox` рассчитывается автоматически.
- На каждый запуск создаётся **один Excel-файл** с датой и временем в имени.
- Внутри Excel:
  - лист **«Организации»** — результаты (компактно, без дублей колонок);
  - лист **«Запрос»** — параметры запуска, bbox, лимиты, время, ошибка (если была).
- Для каждой строки сохраняется `raw_json` (исходный JSON записи) — чтобы позже можно было извлекать любые дополнительные поля.

---

## Требования

- Windows / Linux / macOS
- Python 3.10+ (рекомендуется)
- Интернет-доступ
- Ключ **API Поиска по организациям** (Yandex Maps / Geosearch API)

---

## Установка

### 1) Клонирование репозитория

git clone https://github.com/sadovnikovv/ParserYandexMap.git
cd ParserYandexMap


### 2) Виртуальное окружение (рекомендуется)

**Windows (PowerShell):**
python -m venv .venv
.venv\Scripts\Activate.ps1


**Linux/macOS:**
python3 -m venv .venv
source .venv/bin/activate


### 3) Установка зависимостей

Если у вас есть `requirements.txt`:
pip install -r requirements.txt


Если `requirements.txt` нет:
pip install requests openpyxl python-dotenv


---

## Настройка

### 1) API ключ через `.env`

Создайте в корне проекта файл `.env` (его нельзя коммитить):
YM_API_KEY=ВАШ_КЛЮЧ_ЗДЕСЬ


В репозиторий есть шаблон `.env.example`:
YM_API_KEY=PASTE_YOUR_KEY_HERE


### 2) Параметры запуска (в шапке `main.py`)

Все изменяемые параметры задаются в шапке `main.py`:

**Обязательное**
- `TEXT` — поисковый запрос (например: `поставка металлопроката заготовками`).

**География поиска**
- `CENTER_LON` — долгота центра.
- `CENTER_LAT` — широта центра.
- `DIAMETER_KM` — диаметр области (км).  
  Пример: `17.2` = радиус `8.6 км`.

**Вывод**
- `OUT_DIR` — куда сохранять файл (например `.` или `C:\\Users\\user\\Desktop`).
- `OUT_PREFIX` — префикс имени файла (например `out`).

**Пагинация/ограничения**
- `RESULTS_PER_PAGE` — результатов на страницу (часто 50).
- `MAX_SKIP` — максимальный `skip` (часто 1000).
- `SLEEP_SEC` — пауза между запросами.
- `LOG_EVERY_PAGE` — печатать ли прогресс по страницам.

---

## Запуск

Из папки проекта:
python main.py


В консоли обычно выводится:
- 1-я строка: имя выходного файла + параметры запуска
- далее (опционально): прогресс по страницам
- итог: количество строк и статус сохранения

---

## Формат выходного файла

На каждый запуск создаётся один файл:
- `out_YYYY-MM-DD_HH-MM-SS.xlsx`

Внутри:

1) **Лист «Организации»**  
   Содержит компактные столбцы (без дублей), включая:
   - ID, название, адрес, индекс
   - координаты
   - сайт
   - телефоны (Телефон 1..3)
   - email (Email 1..3)
   - режим работы (одним столбцом)
   - рейтинг/отзывы (если доступны)
   - категории 1..3 + «Категории (прочие)»
   - особенности (одной строкой)
   - `uri`
   - `raw_json` (исходная запись целиком)

2) **Лист «Запрос»**
   - `request_time`
   - `TEXT`, `LANG`
   - `CENTER_LON`, `CENTER_LAT`, `DIAMETER_KM`
   - рассчитанный `bbox`
   - `RESULTS_PER_PAGE`, `MAX_SKIP`, `SLEEP_SEC`
   - (при ошибке) поле `error`

---

## Частые проблемы

### 403 Forbidden / Invalid api key
Ключ не подходит для API Поиска по организациям или доступ к API не активирован в кабинете.

### 0 строк (пустая выдача)
- Маленький `DIAMETER_KM`
- Слишком узкий запрос `TEXT`
- Ограничения/релевантность выдачи (API возвращает наиболее подходящие объекты)

### 429 Too Many Requests
Увеличьте `SLEEP_SEC`, уменьшите частоту запусков.

---

## .gitignore

Минимальный рекомендуемый вариант:

.venv/
pycache/
.idea/
*.xlsx
.env


---

## Лицензия

 **MIT License**: простая permissive-лицензия, которая позволяет использовать/изменять/распространять в любых целях при сохранении copyright и текста лицензии. 