<!-- Title -->
<h1 align="center">YMaps Excel Export</h1>

<p align="center">
  Поиск организаций в Яндекс.Картах через API Поиска по организациям и выгрузка в Excel (.xlsx)
</p>

<p align="center">
  <a href="#возможности">Возможности</a> •
  <a href="#требования">Требования</a> •
  <a href="#установка">Установка</a> •
  <a href="#настройка">Настройка</a> •
  <a href="#запуск">Запуск</a> •
  <a href="#формат-выходного-файла">Формат выходного файла</a> •
  <a href="#частые-проблемы">Частые проблемы</a> •
  <a href="#лицензия">Лицензия</a>
</p>

---

## Возможности

- Поиск организаций по текстовому запросу в заданной области.
- Область поиска задаётся **центром** (долгота/широта) и **диаметром** (км), `bbox` рассчитывается автоматически.
- Сохраняется **один Excel-файл на запуск** с датой и временем в имени.
- В Excel сохраняется:
  - лист **«Организации»** — результаты поиска (приоритет: **Email** и **Сайт**);
  - лист **«Запрос»** — параметры запроса (время, центр, диаметр, bbox, лимиты пагинации).
- Для каждой строки сохраняется `raw_json` (исходные данные записи), чтобы при необходимости позже извлекать дополнительные поля.

---

## Требования

- Windows 10/11 (или Linux/macOS)
- Python 3.10+ (рекомендуется)
- Доступ к интернету
- Ключ **API Поиска по организациям** (Yandex Maps / Geosearch API)

---

## Установка

### 1) Клонирование репозитория

git clone https://github.com/sadovnikovv/ParserYandexMap.git
cd <REPO>

### 2) Виртуальное окружение (рекомендуется)

**Windows (cmd):**
python -m venv .venv
.venv\Scripts\activate

**Linux/macOS:**
python3 -m venv .venv
source .venv/bin/activate

### 3) Установка зависимостей

Если у вас есть `requirements.txt`:
pip install -r requirements.txt

Если `requirements.txt` нет:
pip install requests openpyxl

---

## Настройка

Все изменяемые параметры задаются **только в шапке `main.py`**.  
Ввод с консоли не используется.

Откройте `main.py` и задайте:

### Обязательное
- `API_KEY` — ваш ключ API
- `TEXT` — поисковый запрос (например: `поставка металлопроката заготовками`)

### География поиска
- `CENTER_LON` — долгота центра
- `CENTER_LAT` — широта центра
- `DIAMETER_KM` — диаметр области (км)  
  Пример: `17.2` = радиус `8.6 км`

### Вывод
- `OUT_DIR` — куда сохранять файл (например `.` или `C:\\Users\\user\\Desktop`)
- `OUT_PREFIX` — префикс имени файла (например `out`)

### Пагинация/ограничения
- `RESULTS_PER_PAGE` — результатов на страницу (обычно 50)
- `MAX_SKIP` — максимальный `skip` (обычно 1000)
- `SLEEP_SEC` — пауза между запросами
- `LOG_EVERY_PAGE` — печатать ли прогресс по страницам

---

## Запуск

Из папки проекта:

python main.py

В консоли выводится:
- 1-я строка: имя выходного файла + параметры запуска
- далее (опционально): короткий прогресс по страницам
- итог: количество строк и статус сохранения

---

## Формат выходного файла

На каждый запуск создаётся **один** файл:

- `out_YYYY-MM-DD_HH-MM-SS.xlsx`

Внутри:
1) **Лист «Организации»**
   - основные поля (название, адрес, координаты и пр.)
   - **Email** (если доступен в карточке)
   - **Сайт** (если доступен в карточке)
   - рейтинг/отзывы (если доступны)
   - `raw_json` (вся исходная запись в JSON)

2) **Лист «Запрос»**
   - `request_time`
   - `TEXT`, `LANG`
   - `CENTER_LON`, `CENTER_LAT`, `DIAMETER_KM`
   - рассчитанный `bbox`
   - `RESULTS_PER_PAGE`, `MAX_SKIP`, `SLEEP_SEC`
   - (при ошибке) поле `error`

---

## Частые проблемы

### 403 Forbidden / Invalid api key
Ключ не подходит для API Поиска по организациям или доступ к API не активирован.
Проверьте, что ключ выпущен именно для нужного API и активен в кабинете.

### Пустая выдача (0 строк)
- Маленький `DIAMETER_KM`
- Слишком узкий запрос `TEXT`
- Ограничения/релевантность выдачи (API возвращает наиболее подходящие объекты)

### 429 Too Many Requests
Увеличьте `SLEEP_SEC`, уменьшите частоту запусков.

---

## Рекомендуемый .gitignore

.venv/
pycache/
*.xlsx
.idea/


---

## Структура проекта (пример)

.
├─ main.py
├─ README.md
├─ requirements.txt (опционально)
└─ .gitignore

---

## Лицензия

Добавьте `LICENSE` (например MIT), если планируете публичные форки/использование.
По умолчанию (без LICENSE) права определяются автором репозитория.